\newcommand\unuseddiag[2]{
\begin{figure}
\pgfplotsset{width=\textwidth}
\centering
\begin{tikzpicture}
\begin{axis}[
	ybar,
	xlabel={\#BBs in a Shader},
	ylabel={Unused BBs [\SI{}{\percent}]},
	xmin=0,
	xmax=\runtex{max-bbs -g #1},
	ymin=0,
	ymax=100,
	ytick pos=left,
	grid=both,
	bar width=0.01cm,
]

\runtex{unused-code -g #1}
\end{axis}

\begin{axis}[
	axis y line*=right,
	axis x line=none,
	xlabel={\#BBs in a Shader},
	ylabel={Distribution of shaders [\SI{}{\percent}]},
	xmin=0,
	xmax=\runtex{max-bbs -g #1},
	ymin=0,
	legend style={at={(1,1)},anchor=north east},
]
\addlegendimage{only marks, fill=gray, draw=gray, fill opacity=0.4}\addlegendentry{Shader distribution}
\runtex{bbs -g #1}
\addlegendentry{Shader with unused BBs}
\end{axis}
\end{tikzpicture}
\captionof{figure}{The fraction of unused code by shader size in #2}
\label{dia:unused_by_bb_#1}
\end{figure}
}

\unuseddiag{ashes}{Ashes}
\unuseddiag{dota}{Dota 2}
\unuseddiag{f12017}{F1 2017}
\unuseddiag{infiltrator}{Unreal Infiltrator}
\unuseddiag{madmax}{Mad Max}
\unuseddiag{dow3}{Warhammer}
\unuseddiag{switch}{the switch vm}
